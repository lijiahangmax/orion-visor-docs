var Y=Object.create;var q=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var te=Object.getOwnPropertyNames;var ne=Object.getPrototypeOf,re=Object.prototype.hasOwnProperty;var A=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ie=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of te(t))!re.call(e,i)&&i!==n&&q(e,i,{get:()=>t[i],enumerable:!(r=ee(t,i))||r.enumerable});return e};var se=(e,t,n)=>(n=e!=null?Y(ne(e)):{},ie(t||!e||!e.__esModule?q(n,"default",{value:e,enumerable:!0}):n,e));var N=A(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});F.shellExpand=F.ensureTrailingSlash=void 0;var oe=e=>e.endsWith("/")?e:`${e}/`;F.ensureTrailingSlash=oe;var ae=(e,t)=>e.startsWith("~")&&(e.length===1||e.charAt(1)==="/")?e.replace("~",t):e,ue=(e,t)=>e.replace(/\$([A-Za-z0-9_]+)/g,i=>{var s;let a=i.slice(1);return(s=t[a])!==null&&s!==void 0?s:i}).replace(/\$\{([A-Za-z0-9_]+)(?::-([^}]+))?\}/g,(i,s,a)=>{var c,l;return(l=(c=t[s])!==null&&c!==void 0?c:a)!==null&&l!==void 0?l:i}),ce=(e,t)=>{var n;let{environmentVariables:r}=t;return ue(ae(e,(n=r?.HOME)!==null&&n!==void 0?n:"~"),r)};F.shellExpand=ce});var W=A(v=>{"use strict";var le=v&&v.__awaiter||function(e,t,n,r){function i(s){return s instanceof n?s:new n(function(a){a(s)})}return new(n||(n=Promise))(function(s,a){function c(o){try{u(r.next(o))}catch(f){a(f)}}function l(o){try{u(r.throw(o))}catch(f){a(f)}}function u(o){o.done?s(o.value):i(o.value).then(c,l)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(v,"__esModule",{value:!0});v.filepaths=v.folders=v.getCurrentInsertedDirectory=v.sortFilesAlphabetically=void 0;var P=N();function R(e,t=[]){let n=t.map(i=>i.toLowerCase()),r=e.filter(i=>!n.includes(i.toLowerCase()));return[...r.filter(i=>!i.startsWith(".")).sort((i,s)=>i.localeCompare(s)),...r.filter(i=>i.startsWith(".")).sort((i,s)=>i.localeCompare(s)),"../"]}v.sortFilesAlphabetically=R;var fe=(e,t,n)=>{if(e===null)return"/";let r=(0,P.shellExpand)(t,n),i=r.slice(0,r.lastIndexOf("/")+1);return i===""?(0,P.ensureTrailingSlash)(e):i.startsWith("/")?i:`${(0,P.ensureTrailingSlash)(e)}${i}`};v.getCurrentInsertedDirectory=fe;function C(e={}){let{extensions:t=[],equals:n=[],matches:r,filterFolders:i=!1,editFileSuggestions:s,editFolderSuggestions:a,rootDirectory:c,showFolders:l="always"}=e,u=new Set(t),o=new Set(n),f=()=>t.length>0||n.length>0||r,g=(p=[])=>f()?p.filter(({name:h="",type:S})=>{if(!i&&S==="folder"||o.has(h)||r&&h.match(r))return!0;let[,...d]=h.split(".");if(d.length>=1){let b=d.length-1,O=d[b];do{if(u.has(O))return!0;b-=1,O=[d[b],O].join(".")}while(b>=0)}return!1}):p,_=(p=[])=>!s&&!a?p:p.map(h=>Object.assign(Object.assign({},h),(h.type==="file"?s:a)||{}));return{trigger:(p,h)=>{let S=p.lastIndexOf("/"),d=h.lastIndexOf("/");return S!==d?!0:S===-1&&d===-1?!1:p.slice(0,S)!==h.slice(0,d)},getQueryTerm:p=>p.slice(p.lastIndexOf("/")+1),custom:(p,h,S)=>le(this,void 0,void 0,function*(){var d;let{isDangerous:b,currentWorkingDirectory:O,searchTerm:m}=S,w=(d=(0,v.getCurrentInsertedDirectory)(c??O,m,S))!==null&&d!==void 0?d:"/";try{let E=yield h({command:"ls",args:["-1ApL"],cwd:w}),Z=R(E.stdout.split(`
`),[".DS_Store"]),z=[];for(let j of Z)if(j){let k=j.endsWith("/")?"folders":"filepaths";(k==="filepaths"&&l!=="only"||k==="folders"&&l!=="never")&&z.push({type:k==="filepaths"?"file":"folder",name:j,insertValue:j,isDangerous:b,context:{templateType:k}})}return _(g(z))}catch{return[]}})}}v.folders=Object.assign(()=>C({showFolders:"only"}),Object.freeze(C({showFolders:"only"})));v.filepaths=Object.assign(C,Object.freeze(C()))});var U=A(x=>{"use strict";var I=x&&x.__awaiter||function(e,t,n,r){function i(s){return s instanceof n?s:new n(function(a){a(s)})}return new(n||(n=Promise))(function(s,a){function c(o){try{u(r.next(o))}catch(f){a(f)}}function l(o){try{u(r.throw(o))}catch(f){a(f)}}function u(o){o.done?s(o.value):i(o.value).then(c,l)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(x,"__esModule",{value:!0});x.keyValueList=x.keyValue=x.valueList=void 0;var H=new Map;function V(e,t){return e.length===0?t:t.map(n=>n.insertValue?n:Object.assign(Object.assign({},n),{insertValue:n.name+e}))}function $(e,t,n){return I(this,void 0,void 0,function*(){if(typeof e=="function"){let r=yield e(...n);return V(t,r)}if(typeof e[0]=="string"){let r=e.map(i=>({name:i}));return V(t,r)}return V(t,e)})}function L(e,t,n,r){return I(this,void 0,void 0,function*(){if(n||Array.isArray(e)){let i=H.get(e);return i===void 0&&(i=yield $(e,t,r),H.set(e,i)),i}return $(e,t,r)})}function K(e,t){return typeof t=="string"?e&&t==="keys"||!e&&t==="values":t}function D(e,...t){return Math.max(...t.map(n=>e.lastIndexOf(n)))}function M(e,t){let n=new Set(e);return t.filter(r=>{var i;return typeof r.name=="string"?!n.has(r.name):!(!((i=r.name)===null||i===void 0)&&i.some(s=>n.has(s)))})}function de({delimiter:e=",",values:t=[],cache:n=!1,insertDelimiter:r=!1,allowRepeatedValues:i=!1}){return{trigger:(s,a)=>s.lastIndexOf(e)!==a.lastIndexOf(e),getQueryTerm:s=>s.slice(s.lastIndexOf(e)+e.length),custom:(...s)=>I(this,void 0,void 0,function*(){var a;let c=yield L(t,r?e:"",n,s);if(i)return c;let[l]=s,u=(a=l[l.length-1])===null||a===void 0?void 0:a.split(e);return M(u,c)})}}x.valueList=de;function pe({separator:e="=",keys:t=[],values:n=[],cache:r=!1,insertSeparator:i=!0}){return{trigger:(s,a)=>s.indexOf(e)!==a.indexOf(e),getQueryTerm:s=>s.slice(s.indexOf(e)+1),custom:(...s)=>I(this,void 0,void 0,function*(){let[a]=s,l=!a[a.length-1].includes(e),u=l?t:n,o=K(l,r);return L(u,l&&i?e:"",o,s)})}}x.keyValue=pe;function me({separator:e="=",delimiter:t=",",keys:n=[],values:r=[],cache:i=!1,insertSeparator:s=!0,insertDelimiter:a=!1,allowRepeatedKeys:c=!1,allowRepeatedValues:l=!0}){return{trigger:(u,o)=>{let f=D(u,e,t),g=D(o,e,t);return f!==g},getQueryTerm:u=>{let o=D(u,e,t);return u.slice(o+1)},custom:(...u)=>I(this,void 0,void 0,function*(){let[o]=u,f=o[o.length-1],g=D(f,e,t),_=g===-1||f.slice(g,g+e.length)!==e,p=_?n:r,h=K(_,i),d=yield L(p,_?s?e:"":a?t:"",h,u);if(_){if(c)return d;let O=f.split(t).map(m=>m.slice(0,m.indexOf(e)));return M(O,d)}if(l)return d;let b=f.split(t).map(O=>O.slice(O.indexOf(e)+e.length));return M(b,d)})}}x.keyValueList=me});var J=A(T=>{"use strict";var he=T&&T.__awaiter||function(e,t,n,r){function i(s){return s instanceof n?s:new n(function(a){a(s)})}return new(n||(n=Promise))(function(s,a){function c(o){try{u(r.next(o))}catch(f){a(f)}}function l(o){try{u(r.throw(o))}catch(f){a(f)}}function u(o){o.done?s(o.value):i(o.value).then(c,l)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(T,"__esModule",{value:!0});T.ai=void 0;var ge=4097,ve=4,ye=.8,be=ge*ve*ye;function Se({name:e,prompt:t,message:n,postProcess:r,temperature:i,splitOn:s}){return{scriptTimeout:15e3,custom:(a,c,l)=>he(this,void 0,void 0,function*(){var u,o;let f=yield c({command:"fig",args:["settings","--format","json","autocomplete.ai.enabled"]});if(!JSON.parse(f.stdout))return[];let g=typeof t=="function"?yield t({tokens:a,executeCommand:c,generatorContext:l}):t,_=typeof n=="function"?yield n({tokens:a,executeCommand:c,generatorContext:l}):n;if(_===null||_.length===0)return console.warn("No message provided to AI generator"),[];let p=be-((u=g?.length)!==null&&u!==void 0?u:0),h={model:"gpt-3.5-turbo",source:"autocomplete",name:e,messages:[...g?[{role:"system",content:g}]:[],{role:"user",content:_.slice(0,p)}],temperature:i},S=JSON.stringify(h),d=yield c({command:"fig",args:["_","request","--route","/ai/chat","--method","POST","--body",S]}),b=JSON.parse(d.stdout);return(o=b?.choices.map(m=>{var w;return(w=m?.message)===null||w===void 0?void 0:w.content}).filter(m=>typeof m=="string").flatMap(m=>s?m.split(s).filter(w=>w.trim().length>0):[m]).map(m=>{if(r)return r(m);let w=m.trim().replace(/\n/g," ");return{icon:"\u{1FA84}",name:w,insertValue:`'${w}'`,description:"Generated by Fig AI"}}))!==null&&o!==void 0?o:[]})}}T.ai=Se});var X=A(y=>{"use strict";var Oe=y&&y.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),_e=y&&y.__exportStar||function(e,t){for(var n in e)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&Oe(t,e,n)};Object.defineProperty(y,"__esModule",{value:!0});y.ai=y.folders=y.filepaths=void 0;var Q=W();Object.defineProperty(y,"filepaths",{enumerable:!0,get:function(){return Q.filepaths}});Object.defineProperty(y,"folders",{enumerable:!0,get:function(){return Q.folders}});_e(U(),y);var we=J();Object.defineProperty(y,"ai",{enumerable:!0,get:function(){return we.ai}})});var G=se(X(),1),B=[{name:"--source",description:"Can be a disk image, /dev entry, or volume mountpoint",args:{name:"source",description:"Disk image, /dev entry, or volume mountpoint",template:"filepaths",suggestCurrentToken:!0},dependsOn:["--target","--file"]},{name:"--target",description:"Can be a /dev entry, or volume mountpoint",args:{name:"target",description:"/dev entry, or volume mountpoint",template:"filepaths",suggestCurrentToken:!0}},{name:"--file",description:"When performing a multicast restore, --file can be specified instead of --target",args:{name:"source",description:"Disk image, /dev entry, or volume mountpoint",template:"filepaths",suggestCurrentToken:!0},dependsOn:["--erase"]},{name:"--erase",description:"Erases target and is required. --erase must always be used, as file copies are no longer supported by asr"},{name:"--format",description:"Specifies the destination filesystem format",args:{name:"HFS+ | HFSX",description:"Specify the destination filesystem format",isOptional:!0}},{name:"--noprompt",description:"Suppresses the prompt which usually occurs before target"},{name:"--timeout",description:"Specifies num seconds that a multicast client should wait when no payload data has been received over a multicast stream before exiting",args:{name:"num",description:"Number of seconds that a multicast client should wait",default:"0",isOptional:!0,suggestions:["0"]}},{name:"--puppetstrings",description:"Provide progress output that is easy for another program to parse"},{name:"--noverify",description:"Skips the verification steps normally taken to ensure that a volume has been properly restored"},{name:"--allowfragmentedcatalog",description:"Allows restores to proceed even if the source's catalog file is fragmented"},{name:"--SHA256",description:"Forces the restore to use the SHA-256 hash in the image during verification"},{name:"--sourcevolumename",description:"Tells asr which volume in the source container to invert when doing an APFS restore"},{name:"--sourcevolumeUUID",description:"Tells asr which volume in the source container to invert when doing an APFS restore"},{name:"--useReplication",description:"Forces asr to use replication for restoring APFS volumes"},{name:"--useInverter",description:"Forces asr to use the inverter for restoring APFS volumes"},{name:"--toSnapshot",description:"Specifies the snapshot on the source APFS volume to restore to the target APFS volume"},{name:"--fromSnapshot",description:"Names a snapshot on the source APFS volume to use in combination with --toSnapshot to specify a snapshot delta to restore to the target APFS volume"}],xe=[{name:"--buffers",description:"One of the options that control how asr uses memory",args:{name:"num",description:"Specifies the num buffers should be used"}},{name:"--buffersize",description:"One of the options that control how asr uses memory",args:{name:"size",description:"Specifies the size of each buffer"}},{name:"--csumbuffers",description:"One of the options that control how asr uses memory",args:{name:"num",description:"Specifies that num buffers should be used for checksumming operations"}},{name:"--csumbuffersize",description:"One of the options that control how asr uses memory",args:{name:"size",description:"Specifies the size of each buffer used for checksumming"}}],Fe=[{name:"--verbose",description:"Enables verbose progress and error messages"},{name:"--debug",description:"Enables other progress and error messages"}],Te={name:"asr",description:"Asr efficiently copies disk images onto volumes, either directly or via a multicast network stream",subcommands:[{name:"help",description:"Displays asr usage information"},{name:"version",description:"Displays asr version"},{name:"restore",description:"Restores a disk image or volume to another volume",options:B},{name:"restoreexact",description:"Same as restore verb, except that for an HFS Plus volume, the target partition is resized to match the size of the source partition/ volume",options:B,displayName:"restore[exact]"},{name:"server",description:"Multicasts source over the network",options:[{name:"--source",description:"Source has to be a UDIF disk image",args:{name:"source",description:"UDIF disk image local/remote path",template:"filepaths",suggestCurrentToken:!0}},{name:"--interface",description:"The network interface to be used for multicasting",args:{name:"interface",description:"The network interface to be used for multicasting"}},{name:"--config",description:"Server requires a configuration file to be passed",args:{name:"configuration",description:"Configuration file in standard property list format",generators:(0,G.filepaths)({extensions:["plist"]})}}]},{name:"imagescan",description:"Calculate checksums of the data in the provided image and store them in the image"},{name:"info",description:"Report the image metadata which was placed in the image by a previous use of the imagescan verb",options:[{name:"--plist",description:"Writes its output as an XML-formatted plist"}]}],options:[...xe,...Fe]},Pe=Te;export{Pe as default};
