var te=Object.create;var M=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var ie=Object.getOwnPropertyNames;var se=Object.getPrototypeOf,re=Object.prototype.hasOwnProperty;var T=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ae=(e,t,i,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of ie(t))!re.call(e,s)&&s!==i&&M(e,s,{get:()=>t[s],enumerable:!(n=ne(t,s))||n.enumerable});return e};var oe=(e,t,i)=>(i=e!=null?te(se(e)):{},ae(t||!e||!e.__esModule?M(i,"default",{value:e,enumerable:!0}):i,e));var G=T(O=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});O.shellExpand=O.ensureTrailingSlash=void 0;var ce=e=>e.endsWith("/")?e:`${e}/`;O.ensureTrailingSlash=ce;var le=(e,t)=>e.startsWith("~")&&(e.length===1||e.charAt(1)==="/")?e.replace("~",t):e,ue=(e,t)=>e.replace(/\$([A-Za-z0-9_]+)/g,s=>{var r;let a=s.slice(1);return(r=t[a])!==null&&r!==void 0?r:s}).replace(/\$\{([A-Za-z0-9_]+)(?::-([^}]+))?\}/g,(s,r,a)=>{var u,l;return(l=(u=t[r])!==null&&u!==void 0?u:a)!==null&&l!==void 0?l:s}),de=(e,t)=>{var i;let{environmentVariables:n}=t;return ue(le(e,(i=n?.HOME)!==null&&i!==void 0?i:"~"),n)};O.shellExpand=de});var W=T(y=>{"use strict";var pe=y&&y.__awaiter||function(e,t,i,n){function s(r){return r instanceof i?r:new i(function(a){a(r)})}return new(i||(i=Promise))(function(r,a){function u(o){try{c(n.next(o))}catch(d){a(d)}}function l(o){try{c(n.throw(o))}catch(d){a(d)}}function c(o){o.done?r(o.value):s(o.value).then(u,l)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(y,"__esModule",{value:!0});y.filepaths=y.folders=y.getCurrentInsertedDirectory=y.sortFilesAlphabetically=void 0;var q=G();function N(e,t=[]){let i=t.map(s=>s.toLowerCase()),n=e.filter(s=>!i.includes(s.toLowerCase()));return[...n.filter(s=>!s.startsWith(".")).sort((s,r)=>s.localeCompare(r)),...n.filter(s=>s.startsWith(".")).sort((s,r)=>s.localeCompare(r)),"../"]}y.sortFilesAlphabetically=N;var me=(e,t,i)=>{if(e===null)return"/";let n=(0,q.shellExpand)(t,i),s=n.slice(0,n.lastIndexOf("/")+1);return s===""?(0,q.ensureTrailingSlash)(e):s.startsWith("/")?s:`${(0,q.ensureTrailingSlash)(e)}${s}`};y.getCurrentInsertedDirectory=me;function P(e={}){let{extensions:t=[],equals:i=[],matches:n,filterFolders:s=!1,editFileSuggestions:r,editFolderSuggestions:a,rootDirectory:u,showFolders:l="always"}=e,c=new Set(t),o=new Set(i),d=()=>t.length>0||i.length>0||n,h=(m=[])=>d()?m.filter(({name:g="",type:S})=>{if(!s&&S==="folder"||o.has(g)||n&&g.match(n))return!0;let[,...p]=g.split(".");if(p.length>=1){let v=p.length-1,k=p[v];do{if(c.has(k))return!0;v-=1,k=[p[v],k].join(".")}while(v>=0)}return!1}):m,w=(m=[])=>!r&&!a?m:m.map(g=>Object.assign(Object.assign({},g),(g.type==="file"?r:a)||{}));return{trigger:(m,g)=>{let S=m.lastIndexOf("/"),p=g.lastIndexOf("/");return S!==p?!0:S===-1&&p===-1?!1:m.slice(0,S)!==g.slice(0,p)},getQueryTerm:m=>m.slice(m.lastIndexOf("/")+1),custom:(m,g,S)=>pe(this,void 0,void 0,function*(){var p;let{isDangerous:v,currentWorkingDirectory:k,searchTerm:f}=S,_=(p=(0,y.getCurrentInsertedDirectory)(u??k,f,S))!==null&&p!==void 0?p:"/";try{let F=yield g({command:"ls",args:["-1ApL"],cwd:_}),ee=N(F.stdout.split(`
`),[".DS_Store"]),V=[];for(let I of ee)if(I){let D=I.endsWith("/")?"folders":"filepaths";(D==="filepaths"&&l!=="only"||D==="folders"&&l!=="never")&&V.push({type:D==="filepaths"?"file":"folder",name:I,insertValue:I,isDangerous:v,context:{templateType:D}})}return w(h(V))}catch{return[]}})}}y.folders=Object.assign(()=>P({showFolders:"only"}),Object.freeze(P({showFolders:"only"})));y.filepaths=Object.assign(P,Object.freeze(P()))});var z=T(x=>{"use strict";var A=x&&x.__awaiter||function(e,t,i,n){function s(r){return r instanceof i?r:new i(function(a){a(r)})}return new(i||(i=Promise))(function(r,a){function u(o){try{c(n.next(o))}catch(d){a(d)}}function l(o){try{c(n.throw(o))}catch(d){a(d)}}function c(o){o.done?r(o.value):s(o.value).then(u,l)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(x,"__esModule",{value:!0});x.keyValueList=x.keyValue=x.valueList=void 0;var B=new Map;function E(e,t){return e.length===0?t:t.map(i=>i.insertValue?i:Object.assign(Object.assign({},i),{insertValue:i.name+e}))}function U(e,t,i){return A(this,void 0,void 0,function*(){if(typeof e=="function"){let n=yield e(...i);return E(t,n)}if(typeof e[0]=="string"){let n=e.map(s=>({name:s}));return E(t,n)}return E(t,e)})}function C(e,t,i,n){return A(this,void 0,void 0,function*(){if(i||Array.isArray(e)){let s=B.get(e);return s===void 0&&(s=yield U(e,t,n),B.set(e,s)),s}return U(e,t,n)})}function $(e,t){return typeof t=="string"?e&&t==="keys"||!e&&t==="values":t}function j(e,...t){return Math.max(...t.map(i=>e.lastIndexOf(i)))}function L(e,t){let i=new Set(e);return t.filter(n=>{var s;return typeof n.name=="string"?!i.has(n.name):!(!((s=n.name)===null||s===void 0)&&s.some(r=>i.has(r)))})}function fe({delimiter:e=",",values:t=[],cache:i=!1,insertDelimiter:n=!1,allowRepeatedValues:s=!1}){return{trigger:(r,a)=>r.lastIndexOf(e)!==a.lastIndexOf(e),getQueryTerm:r=>r.slice(r.lastIndexOf(e)+e.length),custom:(...r)=>A(this,void 0,void 0,function*(){var a;let u=yield C(t,n?e:"",i,r);if(s)return u;let[l]=r,c=(a=l[l.length-1])===null||a===void 0?void 0:a.split(e);return L(c,u)})}}x.valueList=fe;function ge({separator:e="=",keys:t=[],values:i=[],cache:n=!1,insertSeparator:s=!0}){return{trigger:(r,a)=>r.indexOf(e)!==a.indexOf(e),getQueryTerm:r=>r.slice(r.indexOf(e)+1),custom:(...r)=>A(this,void 0,void 0,function*(){let[a]=r,l=!a[a.length-1].includes(e),c=l?t:i,o=$(l,n);return C(c,l&&s?e:"",o,r)})}}x.keyValue=ge;function he({separator:e="=",delimiter:t=",",keys:i=[],values:n=[],cache:s=!1,insertSeparator:r=!0,insertDelimiter:a=!1,allowRepeatedKeys:u=!1,allowRepeatedValues:l=!0}){return{trigger:(c,o)=>{let d=j(c,e,t),h=j(o,e,t);return d!==h},getQueryTerm:c=>{let o=j(c,e,t);return c.slice(o+1)},custom:(...c)=>A(this,void 0,void 0,function*(){let[o]=c,d=o[o.length-1],h=j(d,e,t),w=h===-1||d.slice(h,h+e.length)!==e,m=w?i:n,g=$(w,s),p=yield C(m,w?r?e:"":a?t:"",g,c);if(w){if(u)return p;let k=d.split(t).map(f=>f.slice(0,f.indexOf(e)));return L(k,p)}if(l)return p;let v=d.split(t).map(k=>k.slice(k.indexOf(e)+e.length));return L(v,p)})}}x.keyValueList=he});var Q=T(R=>{"use strict";var ye=R&&R.__awaiter||function(e,t,i,n){function s(r){return r instanceof i?r:new i(function(a){a(r)})}return new(i||(i=Promise))(function(r,a){function u(o){try{c(n.next(o))}catch(d){a(d)}}function l(o){try{c(n.throw(o))}catch(d){a(d)}}function c(o){o.done?r(o.value):s(o.value).then(u,l)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(R,"__esModule",{value:!0});R.ai=void 0;var be=4097,ve=4,Se=.8,ke=be*ve*Se;function we({name:e,prompt:t,message:i,postProcess:n,temperature:s,splitOn:r}){return{scriptTimeout:15e3,custom:(a,u,l)=>ye(this,void 0,void 0,function*(){var c,o;let d=yield u({command:"fig",args:["settings","--format","json","autocomplete.ai.enabled"]});if(!JSON.parse(d.stdout))return[];let h=typeof t=="function"?yield t({tokens:a,executeCommand:u,generatorContext:l}):t,w=typeof i=="function"?yield i({tokens:a,executeCommand:u,generatorContext:l}):i;if(w===null||w.length===0)return console.warn("No message provided to AI generator"),[];let m=ke-((c=h?.length)!==null&&c!==void 0?c:0),g={model:"gpt-3.5-turbo",source:"autocomplete",name:e,messages:[...h?[{role:"system",content:h}]:[],{role:"user",content:w.slice(0,m)}],temperature:s},S=JSON.stringify(g),p=yield u({command:"fig",args:["_","request","--route","/ai/chat","--method","POST","--body",S]}),v=JSON.parse(p.stdout);return(o=v?.choices.map(f=>{var _;return(_=f?.message)===null||_===void 0?void 0:_.content}).filter(f=>typeof f=="string").flatMap(f=>r?f.split(r).filter(_=>_.trim().length>0):[f]).map(f=>{if(n)return n(f);let _=f.trim().replace(/\n/g," ");return{icon:"\u{1FA84}",name:_,insertValue:`'${_}'`,description:"Generated by Fig AI"}}))!==null&&o!==void 0?o:[]})}}R.ai=we});var K=T(b=>{"use strict";var _e=b&&b.__createBinding||(Object.create?function(e,t,i,n){n===void 0&&(n=i);var s=Object.getOwnPropertyDescriptor(t,i);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,s)}:function(e,t,i,n){n===void 0&&(n=i),e[n]=t[i]}),xe=b&&b.__exportStar||function(e,t){for(var i in e)i!=="default"&&!Object.prototype.hasOwnProperty.call(t,i)&&_e(t,e,i)};Object.defineProperty(b,"__esModule",{value:!0});b.ai=b.folders=b.filepaths=void 0;var J=W();Object.defineProperty(b,"filepaths",{enumerable:!0,get:function(){return J.filepaths}});Object.defineProperty(b,"folders",{enumerable:!0,get:function(){return J.folders}});xe(z(),b);var Oe=Q();Object.defineProperty(b,"ai",{enumerable:!0,get:function(){return Oe.ai}})});var Z=oe(K(),1),Re="https://raw.githubusercontent.com/vscode-icons/vscode-icons/master/icons/file_type_ruby.svg",X={name:"new",description:"Create a new rails application",args:{name:"path",description:"Path to directory to be created containing the new application"},options:[{name:"-skip-namespace",description:"Skip namespace (affects only isolated applications)",args:{}},{name:["-r","--ruby"],description:"Path to the Ruby binary of your choice",args:{}},{name:"-m",description:"Path to some application template (can be a filesystem path or URL)"},{name:"-d",description:"Preconfigure for selected database - defaults to sqlite3",args:{name:"database",suggestions:["mysql","postgresql","sqlite3","oracle","frontbase","ibm_db","sqlserver","jdbcmysql","jdbcsqlite3","jdbcpostgresql","jdbc"]}},{name:"--skip-gemfile",description:"Don't create a Gemfile"},{name:"-G",description:"Skip .gitignore file"},{name:"--skip-keeps",description:"Skip source control .keep files"},{name:"-M",description:"Skip Action Mailer files"},{name:"--skip-action-mailbox",description:"Skip Action Mailbox gem"},{name:"--skip-action-text",description:"Skip Action Text gem"},{name:"-O",description:"Skip Active Record files"},{name:"--skip-active-storage",description:"Skip Active Storage files"},{name:"-P",description:"Skip Puma related files"},{name:"-C",description:"Skip Action Cable files"},{name:"-S",description:"Skip Sprockets files"},{name:"--skip-spring",description:"Don't install Spring application preloader"},{name:"--skip-listen",description:"Don't generate configuration that depends on the listen gem"},{name:"-J",description:"Skip JavaScript files"},{name:"--skip-turbolinks",description:"Skip turbolinks gem"},{name:"-T",description:"Skip test files"},{name:"--skip-system-test",description:"Skip system test files"},{name:"--skip-bootsnap",description:"Skip bootsnap gem"},{name:"--dev",description:"Setup the application with Gemfile pointing to your Rails checkout"},{name:"--edge",description:"Setup the application with Gemfile pointing to Rails repository"},{name:"--rc",description:"Path to file containing extra configuration options for rails command",args:{name:"path"}},{name:"--no-rc",description:"Skip loading of extra configuration options from .railsrc file"},{name:"--api",description:"Preconfigure smaller stack for API only apps"},{name:"-B",description:"Don't run bundle install"},{name:"--webpacker",description:"Preconfigure Webpack with a particular framework",args:{name:"framework",suggestions:["react","vue","angular","elm","stimulus"]}},{name:"--skip-webpack-install]",description:"Don't run Webpack install"},{name:["--f","--force"],description:"Overwrite files that already exist"},{name:["--p","--pretend"],description:"Run but do not make any changes"},{name:["--q","--quiet"],description:"Suppress status output"},{name:["--s","--skip"],description:"Skip files that already exist"},{name:["--h","--help"],description:"Show this help message and quit"},{name:["--v","--version"],description:"Show Rails version number and quit"}]},H=[{name:"--backtrace",description:"Enable full backtrace.  OUT can be stderr (default) or stdout"},{name:"--comments",description:"Show commented tasks only"},{name:"--job-stats",description:"Display job statistics. LEVEL=history displays a complete job list"},{name:"--rules",description:"Trace the rules resolution"},{name:"--suppress-backtrace",description:"Suppress backtrace lines matching regexp PATTERN. Ignored if --trace is on",args:{name:"pattern"}},{name:["-A","--all"],description:"Show all tasks, even uncommented ones (in combination with -T or -D)"},{name:["-B","--build-all"],description:"Build all prerequisites, including those which are up-to-date"},{name:["-D","--describe"],description:"Describe the tasks (matching optional PATTERN), then exit",args:{name:"pattern",isOptional:!0}},{name:["-e","--execute"],description:"Execute some Ruby code and exit",args:{name:"code"}},{name:["-E","--execute-continue"],description:"Execute some Ruby code, then continue with normal task processing",args:{name:"code"}},{name:["-f","--rakefile"],description:"Use FILENAME as the rakefile to search for",args:{name:"filename"}},{name:"-G",description:"Use standard project Rakefile search paths, ignore system wide rakefiles"},{name:["-g","--system"],description:"Using system wide (global) rakefiles (usually '~/.rake/*.rake')"},{name:["-I","--libdir"],description:"Include LIBDIR in the search path for required modules",args:{name:"libdir"}},{name:["-j","--jobs"],description:"Specifies the maximum number of tasks to execute in parallel. (default is number of CPU cores + 4)",args:{name:"number"}},{name:["-m","--multitask"],description:"Treat all tasks as multitasks",args:{}},{name:["-n","--dry-run"],description:"Do a dry run without executing actions",args:{}},{name:"-N",description:"Do not search parent directories for the Rakefile",args:{}},{name:["-P","--prereqs"],description:"Display the tasks and dependencies, then exit",args:{}},{name:["-p","--execute-print"],description:"Execute some Ruby code, print the result, then exit",args:{}},{name:["-q","--quiet"],description:"Do not log messages to standard output",args:{}},{name:["-r","--require"],description:"Require MODULE before executing rakefile",args:{name:"module"}},{name:["-R","--rakelibdir"],description:"Auto-import any .rake files in RAKELIBDIR. (default is 'rakelib')",args:{name:"rakelibdir"}},{name:"--rakelib",description:"-s, --silent                     Like --quiet, but also suppresses the 'in directory' announcement",args:{}},{name:["-t","--trace"],description:"Turn on invoke/execute tracing, enable full backtrace. OUT can be stderr (default) or stdout",args:{}},{name:["-T","--tasks"],description:"Display the tasks (matching optional PATTERN) with descriptions, then exit. -AT combination displays all of tasks contained no description",args:{}},{name:["-v","--verbose"],description:"Log message to standard output",args:{}},{name:["-V","--version"],description:"Display the program version",args:{}},{name:["-W","--where"],description:"Describe the tasks (matching optional PATTERN), then exit",args:{name:"pattern"}},{name:["-X","--no-deprecation-warnings"],description:"Disable the deprecation warnings",args:{}},{name:["-h","--help"],description:"Display this help message",args:{}}],Y=[{name:["c","console"],description:"Interact with your Rails application from the command line",options:[{name:["-s","--sandbox"],description:"Rollback database modifications on exit"},{name:["-e","--environment"],description:"Specifies the environment to run this console under",args:{name:"environment"}}]},{name:"server",description:"Launch a web server to access your application through a browser",options:[{name:["-e","--environment"],description:"Specifies the environment to run this server under (e.g. test/development/production)",args:{name:"environment"}},{name:["-p","--port"],description:"Runs Rails on the specified port - defaults to 3000",args:{name:"port"}},{name:["-b","--binding"],description:"Binds Rails to the specified IP - defaults to 'localhost' in development and '0.0.0.0' in other environments'",args:{name:"IP"}},{name:["-c","--config"],description:"Uses a custom rackup configuration - defaults to config.ru",args:{name:"file"}},{name:["-d","--daemon"],description:"Runs server as a Daemon"},{name:["-u","--using"],description:"Specifies the Rack server used to run the application (thin/puma/webrick)",args:{name:"server"}},{name:["-P","--pid"],description:"Specifies the PID file - defaults to tmp/pids/server.pid",args:{name:"PID"}},{name:["-C","--dev-caching"],description:"Specifies whether to perform caching in development"},{name:"--early-hints",description:"Enables HTTP/2 early hints"},{name:"--log-to-stdout",description:"Whether to log to stdout. Enabled by default in development when not daemonized"}]},{name:"db:create",description:"Create your database",options:H},{name:"db:migrate",description:"Run any pending database migrations",options:H},{name:"dbconsole",description:"Opens a console to your database (supports MySQL, PostgreSQL, and SQLite3)",options:[{name:"-e",description:"Specifies the environment to run this dbconsole under (e.g. test/development/production)",args:{}},{name:"--mode",description:"Automatically put the sqlite3 database in the specified mode",args:{name:"mode",suggestions:["html","list","line","column"]}},{name:"-p",description:"Automatically provide the password from database.yml",args:{}},{name:"-c",description:"Specifies the connection to use",args:{name:"connection"}},{name:["-db","--database"],description:"Specifies the database to use"}]},{name:"notes",description:"Enumerate all annotations",options:[{name:["-a","--annotations"],requiresSeparator:!0,args:{name:"annotations",isVariadic:!0,description:"Filter by specific annotations, e.g. Foobar TODO"}}]},{name:"generate",description:"Use templates to generate Rails resources",args:[{name:"generator",filterStrategy:"fuzzy",suggestions:["model","resource","scaffold","controller","migration"],generators:{script:["rails","g","--help"],cache:{cacheByDirectory:!0,strategy:"stale-while-revalidate"},postProcess(e){return["Rails:",...e.split("Rails:")[1].trim().split(`
`)].reduce((n,s)=>s.endsWith(":")?[...n,[s.replace(":",""),[]]]:(s.trim().length&&n[n.length-1][1].push(s.trim()),n),[]).reduce((n,[s,r])=>[...n,...r.map(a=>({insertValue:a,name:`${a} (${s})`}))],[])}}},{name:"args",isVariadic:!0}],options:[{name:"-h",description:"Print generator's options and usage",args:{}},{name:"-p",description:"Run but do not make any changes",args:{}},{name:"-f",description:"Overwrite files that already exist",args:{}},{name:"-s",description:"Skip files that already exist",args:{}},{name:"-q",description:"Suppress status output",args:{}}]},{name:"routes",description:"List all of the routes defined in your application",options:[{name:"-c",description:"Filter by a specific controller, e.g. PostsController or Admin::PostsController",args:{}},{name:"-g",description:"Grep routes by a specific pattern",args:{}},{name:"-E",description:"Print routes expanded vertically with parts explained",args:{}}]},{name:"test",description:"Run your test suite",args:{name:"files or directories",generators:(0,Z.filepaths)({extensions:["rb"],editFileSuggestions:{icon:Re}}),isOptional:!0},async generateSpec(e,t){let{stdout:i}=await t({command:"rails",args:["test","--help"]}),n=/(?:(-[a-zA-Z]), )?(--[^ ]+?)[ =]([A-Z_]+)?[ \r\n]+([^\n]+)/g;return{name:"test",options:Array.from(i.matchAll(n)).map(r=>{let[a,u,l,c,o]=r;return{name:l.replace(/\[.+\]/g,""),description:o,args:{name:c}}})}}},X],Te={custom:async(e,t)=>{let i=[];try{let{stdout:n}=await t({command:"rails",args:["--tasks"]}),s=Y.map(a=>a.name);i=Array.from(n.matchAll(/rails ([^ ]+)/g)).map(a=>({name:a[1]})).filter(a=>!s.includes(a.name))}catch(n){console.log("ERROR",n)}return i},cache:{strategy:"stale-while-revalidate",ttl:1e3*60*60*24*3,cacheByDirectory:!0}},Ae={name:"rails",description:"Ruby on Rails CLI",icon:"https://avatars.githubusercontent.com/u/4223?s=48&v=4",generateSpec:async(e,t)=>(await t({command:"bash",args:["-c",`until [[ -f Gemfile ]] || [[ $PWD = '/' ]]; do cd ..; done; if [ -f Gemfile ]; then cat Gemfile | \\grep "gem ['\\"]rails['\\"]"; fi`]})).status===0?{name:"rails",subcommands:Y,args:{generators:Te,isOptional:!0}}:{name:"rails",subcommands:[X]}},Le=Ae;export{Le as default,Te as railsCommandsGenerator};
