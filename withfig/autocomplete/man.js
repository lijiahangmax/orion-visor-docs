var te=Object.create;var R=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var ie=Object.getOwnPropertyNames;var se=Object.getPrototypeOf,re=Object.prototype.hasOwnProperty;var j=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var oe=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of ie(t))!re.call(e,i)&&i!==n&&R(e,i,{get:()=>t[i],enumerable:!(s=ne(t,i))||s.enumerable});return e};var ae=(e,t,n)=>(n=e!=null?te(se(e)):{},oe(t||!e||!e.__esModule?R(n,"default",{value:e,enumerable:!0}):n,e));var G=j(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.shellExpand=T.ensureTrailingSlash=void 0;var le=e=>e.endsWith("/")?e:`${e}/`;T.ensureTrailingSlash=le;var ce=(e,t)=>e.startsWith("~")&&(e.length===1||e.charAt(1)==="/")?e.replace("~",t):e,ue=(e,t)=>e.replace(/\$([A-Za-z0-9_]+)/g,i=>{var r;let o=i.slice(1);return(r=t[o])!==null&&r!==void 0?r:i}).replace(/\$\{([A-Za-z0-9_]+)(?::-([^}]+))?\}/g,(i,r,o)=>{var c,f;return(f=(c=t[r])!==null&&c!==void 0?c:o)!==null&&f!==void 0?f:i}),fe=(e,t)=>{var n;let{environmentVariables:s}=t;return ue(ce(e,(n=s?.HOME)!==null&&n!==void 0?n:"~"),s)};T.shellExpand=fe});var K=j(_=>{"use strict";var de=_&&_.__awaiter||function(e,t,n,s){function i(r){return r instanceof n?r:new n(function(o){o(r)})}return new(n||(n=Promise))(function(r,o){function c(a){try{l(s.next(a))}catch(u){o(u)}}function f(a){try{l(s.throw(a))}catch(u){o(u)}}function l(a){a.done?r(a.value):i(a.value).then(c,f)}l((s=s.apply(e,t||[])).next())})};Object.defineProperty(_,"__esModule",{value:!0});_.filepaths=_.folders=_.getCurrentInsertedDirectory=_.sortFilesAlphabetically=void 0;var P=G();function H(e,t=[]){let n=t.map(i=>i.toLowerCase()),s=e.filter(i=>!n.includes(i.toLowerCase()));return[...s.filter(i=>!i.startsWith(".")).sort((i,r)=>i.localeCompare(r)),...s.filter(i=>i.startsWith(".")).sort((i,r)=>i.localeCompare(r)),"../"]}_.sortFilesAlphabetically=H;var pe=(e,t,n)=>{if(e===null)return"/";let s=(0,P.shellExpand)(t,n),i=s.slice(0,s.lastIndexOf("/")+1);return i===""?(0,P.ensureTrailingSlash)(e):i.startsWith("/")?i:`${(0,P.ensureTrailingSlash)(e)}${i}`};_.getCurrentInsertedDirectory=pe;function L(e={}){let{extensions:t=[],equals:n=[],matches:s,filterFolders:i=!1,editFileSuggestions:r,editFolderSuggestions:o,rootDirectory:c,showFolders:f="always"}=e,l=new Set(t),a=new Set(n),u=()=>t.length>0||n.length>0||s,h=(p=[])=>u()?p.filter(({name:g="",type:v})=>{if(!i&&v==="folder"||a.has(g)||s&&g.match(s))return!0;let[,...d]=g.split(".");if(d.length>=1){let S=d.length-1,O=d[S];do{if(l.has(O))return!0;S-=1,O=[d[S],O].join(".")}while(S>=0)}return!1}):p,m=(p=[])=>!r&&!o?p:p.map(g=>Object.assign(Object.assign({},g),(g.type==="file"?r:o)||{}));return{trigger:(p,g)=>{let v=p.lastIndexOf("/"),d=g.lastIndexOf("/");return v!==d?!0:v===-1&&d===-1?!1:p.slice(0,v)!==g.slice(0,d)},getQueryTerm:p=>p.slice(p.lastIndexOf("/")+1),custom:(p,g,v)=>de(this,void 0,void 0,function*(){var d;let{isDangerous:S,currentWorkingDirectory:O,searchTerm:y}=v,w=(d=(0,_.getCurrentInsertedDirectory)(c??O,y,v))!==null&&d!==void 0?d:"/";try{let W=yield g({command:"ls",args:["-1ApL"],cwd:w}),ee=H(W.stdout.split(`
`),[".DS_Store"]),$=[];for(let M of ee)if(M){let C=M.endsWith("/")?"folders":"filepaths";(C==="filepaths"&&f!=="only"||C==="folders"&&f!=="never")&&$.push({type:C==="filepaths"?"file":"folder",name:M,insertValue:M,isDangerous:S,context:{templateType:C}})}return m(h($))}catch{return[]}})}}_.folders=Object.assign(()=>L({showFolders:"only"}),Object.freeze(L({showFolders:"only"})));_.filepaths=Object.assign(L,Object.freeze(L()))});var B=j(x=>{"use strict";var F=x&&x.__awaiter||function(e,t,n,s){function i(r){return r instanceof n?r:new n(function(o){o(r)})}return new(n||(n=Promise))(function(r,o){function c(a){try{l(s.next(a))}catch(u){o(u)}}function f(a){try{l(s.throw(a))}catch(u){o(u)}}function l(a){a.done?r(a.value):i(a.value).then(c,f)}l((s=s.apply(e,t||[])).next())})};Object.defineProperty(x,"__esModule",{value:!0});x.keyValueList=x.keyValue=x.valueList=void 0;var z=new Map;function q(e,t){return e.length===0?t:t.map(n=>n.insertValue?n:Object.assign(Object.assign({},n),{insertValue:n.name+e}))}function Q(e,t,n){return F(this,void 0,void 0,function*(){if(typeof e=="function"){let s=yield e(...n);return q(t,s)}if(typeof e[0]=="string"){let s=e.map(i=>({name:i}));return q(t,s)}return q(t,e)})}function N(e,t,n,s){return F(this,void 0,void 0,function*(){if(n||Array.isArray(e)){let i=z.get(e);return i===void 0&&(i=yield Q(e,t,s),z.set(e,i)),i}return Q(e,t,s)})}function k(e,t){return typeof t=="string"?e&&t==="keys"||!e&&t==="values":t}function V(e,...t){return Math.max(...t.map(n=>e.lastIndexOf(n)))}function E(e,t){let n=new Set(e);return t.filter(s=>{var i;return typeof s.name=="string"?!n.has(s.name):!(!((i=s.name)===null||i===void 0)&&i.some(r=>n.has(r)))})}function ge({delimiter:e=",",values:t=[],cache:n=!1,insertDelimiter:s=!1,allowRepeatedValues:i=!1}){return{trigger:(r,o)=>r.lastIndexOf(e)!==o.lastIndexOf(e),getQueryTerm:r=>r.slice(r.lastIndexOf(e)+e.length),custom:(...r)=>F(this,void 0,void 0,function*(){var o;let c=yield N(t,s?e:"",n,r);if(i)return c;let[f]=r,l=(o=f[f.length-1])===null||o===void 0?void 0:o.split(e);return E(l,c)})}}x.valueList=ge;function he({separator:e="=",keys:t=[],values:n=[],cache:s=!1,insertSeparator:i=!0}){return{trigger:(r,o)=>r.indexOf(e)!==o.indexOf(e),getQueryTerm:r=>r.slice(r.indexOf(e)+1),custom:(...r)=>F(this,void 0,void 0,function*(){let[o]=r,f=!o[o.length-1].includes(e),l=f?t:n,a=k(f,s);return N(l,f&&i?e:"",a,r)})}}x.keyValue=he;function me({separator:e="=",delimiter:t=",",keys:n=[],values:s=[],cache:i=!1,insertSeparator:r=!0,insertDelimiter:o=!1,allowRepeatedKeys:c=!1,allowRepeatedValues:f=!0}){return{trigger:(l,a)=>{let u=V(l,e,t),h=V(a,e,t);return u!==h},getQueryTerm:l=>{let a=V(l,e,t);return l.slice(a+1)},custom:(...l)=>F(this,void 0,void 0,function*(){let[a]=l,u=a[a.length-1],h=V(u,e,t),m=h===-1||u.slice(h,h+e.length)!==e,p=m?n:s,g=k(m,i),d=yield N(p,m?r?e:"":o?t:"",g,l);if(m){if(c)return d;let O=u.split(t).map(y=>y.slice(0,y.indexOf(e)));return E(O,d)}if(f)return d;let S=u.split(t).map(O=>O.slice(O.indexOf(e)+e.length));return E(S,d)})}}x.keyValueList=me});var J=j(I=>{"use strict";var ye=I&&I.__awaiter||function(e,t,n,s){function i(r){return r instanceof n?r:new n(function(o){o(r)})}return new(n||(n=Promise))(function(r,o){function c(a){try{l(s.next(a))}catch(u){o(u)}}function f(a){try{l(s.throw(a))}catch(u){o(u)}}function l(a){a.done?r(a.value):i(a.value).then(c,f)}l((s=s.apply(e,t||[])).next())})};Object.defineProperty(I,"__esModule",{value:!0});I.ai=void 0;var ve=4097,_e=4,be=.8,Se=ve*_e*be;function Oe({name:e,prompt:t,message:n,postProcess:s,temperature:i,splitOn:r}){return{scriptTimeout:15e3,custom:(o,c,f)=>ye(this,void 0,void 0,function*(){var l,a;let u=yield c({command:"fig",args:["settings","--format","json","autocomplete.ai.enabled"]});if(!JSON.parse(u.stdout))return[];let h=typeof t=="function"?yield t({tokens:o,executeCommand:c,generatorContext:f}):t,m=typeof n=="function"?yield n({tokens:o,executeCommand:c,generatorContext:f}):n;if(m===null||m.length===0)return console.warn("No message provided to AI generator"),[];let p=Se-((l=h?.length)!==null&&l!==void 0?l:0),g={model:"gpt-3.5-turbo",source:"autocomplete",name:e,messages:[...h?[{role:"system",content:h}]:[],{role:"user",content:m.slice(0,p)}],temperature:i},v=JSON.stringify(g),d=yield c({command:"fig",args:["_","request","--route","/ai/chat","--method","POST","--body",v]}),S=JSON.parse(d.stdout);return(a=S?.choices.map(y=>{var w;return(w=y?.message)===null||w===void 0?void 0:w.content}).filter(y=>typeof y=="string").flatMap(y=>r?y.split(r).filter(w=>w.trim().length>0):[y]).map(y=>{if(s)return s(y);let w=y.trim().replace(/\n/g," ");return{icon:"\u{1FA84}",name:w,insertValue:`'${w}'`,description:"Generated by Fig AI"}}))!==null&&a!==void 0?a:[]})}}I.ai=Oe});var X=j(b=>{"use strict";var we=b&&b.__createBinding||(Object.create?function(e,t,n,s){s===void 0&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){s===void 0&&(s=n),e[s]=t[n]}),xe=b&&b.__exportStar||function(e,t){for(var n in e)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&we(t,e,n)};Object.defineProperty(b,"__esModule",{value:!0});b.ai=b.folders=b.filepaths=void 0;var U=K();Object.defineProperty(b,"filepaths",{enumerable:!0,get:function(){return U.filepaths}});Object.defineProperty(b,"folders",{enumerable:!0,get:function(){return U.folders}});xe(B(),b);var Te=J();Object.defineProperty(b,"ai",{enumerable:!0,get:function(){return Te.ai}})});var Y=ae(X(),1),Ie={1:"General commands",2:"System calls",3:"C library functions",4:"Devices and special files",5:"File formats and conventions",6:"Games, etc",7:"Miscellanea",8:"System admin and daemons"},A=new Map,Z=0,je=1e3*60*60,D=!1,Fe={trigger:(e,t)=>e.length===0||t.length===0&&e.length>0,scriptTimeout:15e3,custom:async(e,t)=>{let n=e[e.length-1],s=Date.now();if(s-Z>je&&(A.clear(),Z=s),!D&&A.size===0){D=!0;let{stdout:i}=await t({command:"man",args:["-k","."]}),r=new Set;for(let o of i.split(`
`)){let c=o.indexOf(" - "),f=o.slice(0,c),l=o.slice(c+3)||"Manual page";l=l[0].toLocaleUpperCase()+l.slice(1);let a=f.split(", ");for(let u of a){let h=u.lastIndexOf("("),m=u.slice(0,h),p=u.slice(h);if(r.has(m))continue;r.add(m);let g={name:m,description:`${p} ${l}`,icon:"fig://icon?type=string"},v=A.get(m[0]);v?v.push(g):A.set(m[0],[g])}}D=!1}else D&&await new Promise(i=>setTimeout(()=>i(),4e3));return A.get(n[0]||"a")||[]}},Ae={name:"man",description:"Format and display the on-line manual pages",args:{generators:Fe,isOptional:!0,isVariadic:!0},options:[{name:"-C",description:"Specify the configuration file to use",args:{name:"config_file"}},{name:"-M",description:"Specify the list of directories to search (colon separated)",args:{name:"path",generators:{template:"folders",getQueryTerm:":"}}},{name:"-P",description:"Specify the pager program",args:{name:"pager"}},{name:"-B",description:"Specify which browser to use for HTML files",args:{name:"browser",default:"/usr/bin/less -is"}},{name:"-H",description:"Specify a command that renders HTML files as text",args:{name:"command",default:"/bin/cat"}},{name:"-S",description:"Specify a colon-separated list of manual sections to search",args:{name:"sections",generators:(0,Y.valueList)({delimiter:":",insertDelimiter:!0,values:Object.entries(Ie).map(([e,t])=>({name:e,description:t,icon:"\u{1F4D1}"}))})}},{name:"-a",description:"Open every matching page instead of just the first"},{name:"-c",description:"Reformat the source page, even when an up-to-date cat-page exists"},{name:"-d",description:"Don't actually display the pages (dry run)"},{name:"-D",description:"Both display and print debugging info"},{name:"-f",description:"Equivalent to `whatis`"},{name:["-F","--preformat"],description:"Format only, do not display"},{name:"-h",description:"Print a help message and exit"},{name:"-k",description:"Equivalent to apropos"},{name:"-K",description:"Search for a given string in all pages"},{name:"-m",description:"Specify an alternate set of pages to search based on the system name given",args:{name:"system"}},{name:"-p",description:"Specify the sequence of preprocessors to run before nroff or troff",args:{name:"preprocessors"}},{name:"-t",description:"Use `/usr/bin/groff -Tps -mandoc -c` to format the page"},{name:["-w","--path"],description:"Print the location of files that would be displayed"},{name:"-W",description:"Print file locations, one per line"}]},qe=Ae;export{qe as default};
