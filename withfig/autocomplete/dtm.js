var Y=Object.create;var W=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var te=Object.getPrototypeOf,ie=Object.prototype.hasOwnProperty;var I=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports);var oe=(e,n,t,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of ne(n))!ie.call(e,o)&&o!==t&&W(e,o,{get:()=>n[o],enumerable:!(i=ee(n,o))||i.enumerable});return e};var re=(e,n,t)=>(t=e!=null?Y(te(e)):{},oe(n||!e||!e.__esModule?W(t,"default",{value:e,enumerable:!0}):t,e));var N=I(x=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0});x.shellExpand=x.ensureTrailingSlash=void 0;var se=e=>e.endsWith("/")?e:`${e}/`;x.ensureTrailingSlash=se;var ae=(e,n)=>e.startsWith("~")&&(e.length===1||e.charAt(1)==="/")?e.replace("~",n):e,le=(e,n)=>e.replace(/\$([A-Za-z0-9_]+)/g,o=>{var r;let a=o.slice(1);return(r=n[a])!==null&&r!==void 0?r:o}).replace(/\$\{([A-Za-z0-9_]+)(?::-([^}]+))?\}/g,(o,r,a)=>{var c,u;return(u=(c=n[r])!==null&&c!==void 0?c:a)!==null&&u!==void 0?u:o}),ce=(e,n)=>{var t;let{environmentVariables:i}=n;return le(ae(e,(t=i?.HOME)!==null&&t!==void 0?t:"~"),i)};x.shellExpand=ce});var $=I(y=>{"use strict";var ue=y&&y.__awaiter||function(e,n,t,i){function o(r){return r instanceof t?r:new t(function(a){a(r)})}return new(t||(t=Promise))(function(r,a){function c(s){try{l(i.next(s))}catch(d){a(d)}}function u(s){try{l(i.throw(s))}catch(d){a(d)}}function l(s){s.done?r(s.value):o(s.value).then(c,u)}l((i=i.apply(e,n||[])).next())})};Object.defineProperty(y,"__esModule",{value:!0});y.filepaths=y.folders=y.getCurrentInsertedDirectory=y.sortFilesAlphabetically=void 0;var L=N();function R(e,n=[]){let t=n.map(o=>o.toLowerCase()),i=e.filter(o=>!t.includes(o.toLowerCase()));return[...i.filter(o=>!o.startsWith(".")).sort((o,r)=>o.localeCompare(r)),...i.filter(o=>o.startsWith(".")).sort((o,r)=>o.localeCompare(r)),"../"]}y.sortFilesAlphabetically=R;var de=(e,n,t)=>{if(e===null)return"/";let i=(0,L.shellExpand)(n,t),o=i.slice(0,i.lastIndexOf("/")+1);return o===""?(0,L.ensureTrailingSlash)(e):o.startsWith("/")?o:`${(0,L.ensureTrailingSlash)(e)}${o}`};y.getCurrentInsertedDirectory=de;function C(e={}){let{extensions:n=[],equals:t=[],matches:i,filterFolders:o=!1,editFileSuggestions:r,editFolderSuggestions:a,rootDirectory:c,showFolders:u="always"}=e,l=new Set(n),s=new Set(t),d=()=>n.length>0||t.length>0||i,h=(p=[])=>d()?p.filter(({name:g="",type:w})=>{if(!o&&w==="folder"||s.has(g)||i&&g.match(i))return!0;let[,...f]=g.split(".");if(f.length>=1){let b=f.length-1,S=f[b];do{if(l.has(S))return!0;b-=1,S=[f[b],S].join(".")}while(b>=0)}return!1}):p,O=(p=[])=>!r&&!a?p:p.map(g=>Object.assign(Object.assign({},g),(g.type==="file"?r:a)||{}));return{trigger:(p,g)=>{let w=p.lastIndexOf("/"),f=g.lastIndexOf("/");return w!==f?!0:w===-1&&f===-1?!1:p.slice(0,w)!==g.slice(0,f)},getQueryTerm:p=>p.slice(p.lastIndexOf("/")+1),custom:(p,g,w)=>ue(this,void 0,void 0,function*(){var f;let{isDangerous:b,currentWorkingDirectory:S,searchTerm:m}=w,_=(f=(0,y.getCurrentInsertedDirectory)(c??S,m,w))!==null&&f!==void 0?f:"/";try{let E=yield g({command:"ls",args:["-1ApL"],cwd:_}),Z=R(E.stdout.split(`
`),[".DS_Store"]),z=[];for(let j of Z)if(j){let V=j.endsWith("/")?"folders":"filepaths";(V==="filepaths"&&u!=="only"||V==="folders"&&u!=="never")&&z.push({type:V==="filepaths"?"file":"folder",name:j,insertValue:j,isDangerous:b,context:{templateType:V}})}return O(h(z))}catch{return[]}})}}y.folders=Object.assign(()=>C({showFolders:"only"}),Object.freeze(C({showFolders:"only"})));y.filepaths=Object.assign(C,Object.freeze(C()))});var Q=I(D=>{"use strict";var P=D&&D.__awaiter||function(e,n,t,i){function o(r){return r instanceof t?r:new t(function(a){a(r)})}return new(t||(t=Promise))(function(r,a){function c(s){try{l(i.next(s))}catch(d){a(d)}}function u(s){try{l(i.throw(s))}catch(d){a(d)}}function l(s){s.done?r(s.value):o(s.value).then(c,u)}l((i=i.apply(e,n||[])).next())})};Object.defineProperty(D,"__esModule",{value:!0});D.keyValueList=D.keyValue=D.valueList=void 0;var K=new Map;function G(e,n){return e.length===0?n:n.map(t=>t.insertValue?t:Object.assign(Object.assign({},t),{insertValue:t.name+e}))}function H(e,n,t){return P(this,void 0,void 0,function*(){if(typeof e=="function"){let i=yield e(...t);return G(n,i)}if(typeof e[0]=="string"){let i=e.map(o=>({name:o}));return G(n,i)}return G(n,e)})}function q(e,n,t,i){return P(this,void 0,void 0,function*(){if(t||Array.isArray(e)){let o=K.get(e);return o===void 0&&(o=yield H(e,n,i),K.set(e,o)),o}return H(e,n,i)})}function J(e,n){return typeof n=="string"?e&&n==="keys"||!e&&n==="values":n}function A(e,...n){return Math.max(...n.map(t=>e.lastIndexOf(t)))}function M(e,n){let t=new Set(e);return n.filter(i=>{var o;return typeof i.name=="string"?!t.has(i.name):!(!((o=i.name)===null||o===void 0)&&o.some(r=>t.has(r)))})}function fe({delimiter:e=",",values:n=[],cache:t=!1,insertDelimiter:i=!1,allowRepeatedValues:o=!1}){return{trigger:(r,a)=>r.lastIndexOf(e)!==a.lastIndexOf(e),getQueryTerm:r=>r.slice(r.lastIndexOf(e)+e.length),custom:(...r)=>P(this,void 0,void 0,function*(){var a;let c=yield q(n,i?e:"",t,r);if(o)return c;let[u]=r,l=(a=u[u.length-1])===null||a===void 0?void 0:a.split(e);return M(l,c)})}}D.valueList=fe;function pe({separator:e="=",keys:n=[],values:t=[],cache:i=!1,insertSeparator:o=!0}){return{trigger:(r,a)=>r.indexOf(e)!==a.indexOf(e),getQueryTerm:r=>r.slice(r.indexOf(e)+1),custom:(...r)=>P(this,void 0,void 0,function*(){let[a]=r,u=!a[a.length-1].includes(e),l=u?n:t,s=J(u,i);return q(l,u&&o?e:"",s,r)})}}D.keyValue=pe;function me({separator:e="=",delimiter:n=",",keys:t=[],values:i=[],cache:o=!1,insertSeparator:r=!0,insertDelimiter:a=!1,allowRepeatedKeys:c=!1,allowRepeatedValues:u=!0}){return{trigger:(l,s)=>{let d=A(l,e,n),h=A(s,e,n);return d!==h},getQueryTerm:l=>{let s=A(l,e,n);return l.slice(s+1)},custom:(...l)=>P(this,void 0,void 0,function*(){let[s]=l,d=s[s.length-1],h=A(d,e,n),O=h===-1||d.slice(h,h+e.length)!==e,p=O?t:i,g=J(O,o),f=yield q(p,O?r?e:"":a?n:"",g,l);if(O){if(c)return f;let S=d.split(n).map(m=>m.slice(0,m.indexOf(e)));return M(S,f)}if(u)return f;let b=d.split(n).map(S=>S.slice(S.indexOf(e)+e.length));return M(b,f)})}}D.keyValueList=me});var U=I(T=>{"use strict";var ge=T&&T.__awaiter||function(e,n,t,i){function o(r){return r instanceof t?r:new t(function(a){a(r)})}return new(t||(t=Promise))(function(r,a){function c(s){try{l(i.next(s))}catch(d){a(d)}}function u(s){try{l(i.throw(s))}catch(d){a(d)}}function l(s){s.done?r(s.value):o(s.value).then(c,u)}l((i=i.apply(e,n||[])).next())})};Object.defineProperty(T,"__esModule",{value:!0});T.ai=void 0;var he=4097,ye=4,ve=.8,be=he*ye*ve;function we({name:e,prompt:n,message:t,postProcess:i,temperature:o,splitOn:r}){return{scriptTimeout:15e3,custom:(a,c,u)=>ge(this,void 0,void 0,function*(){var l,s;let d=yield c({command:"fig",args:["settings","--format","json","autocomplete.ai.enabled"]});if(!JSON.parse(d.stdout))return[];let h=typeof n=="function"?yield n({tokens:a,executeCommand:c,generatorContext:u}):n,O=typeof t=="function"?yield t({tokens:a,executeCommand:c,generatorContext:u}):t;if(O===null||O.length===0)return console.warn("No message provided to AI generator"),[];let p=be-((l=h?.length)!==null&&l!==void 0?l:0),g={model:"gpt-3.5-turbo",source:"autocomplete",name:e,messages:[...h?[{role:"system",content:h}]:[],{role:"user",content:O.slice(0,p)}],temperature:o},w=JSON.stringify(g),f=yield c({command:"fig",args:["_","request","--route","/ai/chat","--method","POST","--body",w]}),b=JSON.parse(f.stdout);return(s=b?.choices.map(m=>{var _;return(_=m?.message)===null||_===void 0?void 0:_.content}).filter(m=>typeof m=="string").flatMap(m=>r?m.split(r).filter(_=>_.trim().length>0):[m]).map(m=>{if(i)return i(m);let _=m.trim().replace(/\n/g," ");return{icon:"\u{1FA84}",name:_,insertValue:`'${_}'`,description:"Generated by Fig AI"}}))!==null&&s!==void 0?s:[]})}}T.ai=we});var B=I(v=>{"use strict";var Se=v&&v.__createBinding||(Object.create?function(e,n,t,i){i===void 0&&(i=t);var o=Object.getOwnPropertyDescriptor(n,t);(!o||("get"in o?!n.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,i,o)}:function(e,n,t,i){i===void 0&&(i=t),e[i]=n[t]}),Oe=v&&v.__exportStar||function(e,n){for(var t in e)t!=="default"&&!Object.prototype.hasOwnProperty.call(n,t)&&Se(n,e,t)};Object.defineProperty(v,"__esModule",{value:!0});v.ai=v.folders=v.filepaths=void 0;var k=$();Object.defineProperty(v,"filepaths",{enumerable:!0,get:function(){return k.filepaths}});Object.defineProperty(v,"folders",{enumerable:!0,get:function(){return k.folders}});Oe(Q(),v);var _e=U();Object.defineProperty(v,"ai",{enumerable:!0,get:function(){return _e.ai}})});var X=re(B(),1),F={plugins:{script:["dtm","list","plugins"],postProcess:e=>e.startsWith("fatal:")?[]:e.split(`
`).map(n=>({name:n.trim(),description:"Plugin"}))},yamlFiles:(0,X.filepaths)({extensions:["yaml","yml"]})},De={name:"dtm",description:"DevStream is an open-source DevOps toolchain manager",subcommands:[{name:"apply",description:"Create or update DevOps tools according to DevStream configuration file",options:[{name:["--config-file","-f"],description:"Config file",args:{name:"config-file",default:"config.yaml",template:["filepaths"],generators:F.yamlFiles}},{name:["--plugin-dir","-d"],description:"Plugins directory",args:{name:"plugin-dir",template:["folders"]}},{name:["--yes","-y"],description:"Apply directly without confirmation"}]},{name:"completion",description:"Generate the autocompletion script for dtm for the specified shell",subcommands:[{name:"bash",description:"Generate autocompletion script for bash"},{name:"fish",description:"Generate autocompletion script for fish"},{name:"powershell",description:"Generate autocompletion script for powershell"},{name:"zsh",description:"Generate autocompletion script for zsh"}]},{name:"delete",description:"Delete DevOps tools according to DevStream configuration file",options:[{name:["--config-file","-f"],description:"Config file",args:{name:"config-file",default:"config.yaml",template:["filepaths"],generators:F.yamlFiles}},{name:"--force",description:"Force delete by config"},{name:["--plugin-dir","-d"],description:"Plugins directory",args:{name:"plugin-dir",template:["folders"]}},{name:["--yes","-y"],description:"Delete directly without confirmation"}]},{name:"destroy",description:"Destroy DevOps tools deployment according to DevStream configuration file & state file",options:[{name:["--config-file","-f"],description:"Config file",args:{name:"config-file",default:"config.yaml",template:["filepaths"],generators:F.yamlFiles}},{name:"--force",description:"Force destroy by config"},{name:["--plugin-dir","-d"],description:"Plugins directory",args:{name:"plugin-dir"}},{name:["--yes","-y"],description:"Destroy directly without confirmation"}]},{name:"develop",description:"Develop is used for develop a new plugin",subcommands:[{name:"create-plugin",description:"Create a new plugin",options:[{name:["--name","-n"],description:"Specify name of the plugin to be created",isPersistent:!0,args:{name:"name"}}]},{name:"validate-plugin",description:"Validate a plugin",options:[{name:["--all","-a"],description:"Validate all plugins",isPersistent:!0},{name:["--name","-n"],description:"Specify name of the plugin to be validated",isPersistent:!0,args:{name:"name"}}]}]},{name:"init",description:"Download needed plugins according to the config file",options:[{name:["--all","-a"],description:"Download all plugins"},{name:"--arch",description:"Download plugins for specific arch",args:{name:"arch",default:"amd64"}},{name:["--config-file","-f"],description:"Config file",args:{name:"config-file",default:"config.yaml",template:["filepaths"],generators:F.yamlFiles}},{name:"--download-only",description:"Download plugins only"},{name:"--os",description:"Download plugins for specific os",args:{name:"os",default:"linux"}},{name:["--plugin-dir","-d"],description:"Plugins directory",args:{name:"plugin-dir",template:["folders"]}},{name:["--plugins","-p"],description:"The plugins to be downloaded",args:{name:"plugins"}}]},{name:"list",description:"This command only supports listing plugins now",subcommands:[{name:"plugins",description:"List all plugins",options:[{name:["--filter","-r"],description:"Filter plugin by regex",isPersistent:!0,args:{name:"filter"}}]}]},{name:"show",description:"Show is used to print plugins' configuration templates or status",subcommands:[{name:"config",description:"Show configuration information",options:[{name:["--plugin","-p"],description:"Specify name with the plugin",args:{name:"plugin",generators:F.plugins}},{name:["--template","-t"],description:"Print a template config, e.g. quickstart/gitops/",args:{name:"template"}}]},{name:"status",description:"Show status information",options:[{name:["--all","-a"],description:"Show all instances of all plugins status"},{name:["--config-file","-f"],description:"Config file",args:{name:"config-file",default:"config.yaml"}},{name:["--id","-i"],description:"Specify id with the plugin instance",args:{name:"id"}},{name:["--plugin","-p"],description:"Specify name with the plugin",args:{name:"plugin"}},{name:["--plugin-dir","-d"],description:"Plugins directory",args:{name:"plugin-dir"}}]}]},{name:"upgrade",description:"Upgrade dtm to the latest release version",options:[{name:["--yes","-y"],description:"Upgrade directly without confirmation"}]},{name:"verify",description:"Verify DevOps tools according to DevStream config file and state",options:[{name:["--config-file","-f"],description:"Config file",args:{name:"config-file",default:"config.yaml",template:["filepaths"],generators:F.yamlFiles}},{name:["--plugin-dir","-d"],description:"Plugins directory",args:{name:"plugin-dir",template:["folders"]}}]},{name:"version",description:"Print the version number of DevStream"},{name:"help",description:"Help about any command",subcommands:[{name:"apply",description:"Create or update DevOps tools according to DevStream configuration file"},{name:"completion",description:"Generate the autocompletion script for dtm for the specified shell",subcommands:[{name:"bash",description:"Generate autocompletion script for bash"},{name:"fish",description:"Generate autocompletion script for fish"},{name:"powershell",description:"Generate autocompletion script for powershell"},{name:"zsh",description:"Generate autocompletion script for zsh"}]},{name:"delete",description:"Delete DevOps tools according to DevStream configuration file"},{name:"destroy",description:"Destroy DevOps tools deployment according to DevStream configuration file & state file"},{name:"develop",description:"Develop is used for develop a new plugin",subcommands:[{name:"create-plugin",description:"Create a new plugin"},{name:"validate-plugin",description:"Validate a plugin"}]},{name:"init",description:"Download needed plugins according to the config file"},{name:"list",description:"This command only supports listing plugins now",subcommands:[{name:"plugins",description:"List all plugins"}]},{name:"show",description:"Show is used to print plugins' configuration templates or status",subcommands:[{name:"config",description:"Show configuration information"},{name:"status",description:"Show status information"}]},{name:"upgrade",description:"Upgrade dtm to the latest release version"},{name:"verify",description:"Verify DevOps tools according to DevStream config file and state"},{name:"version",description:"Print the version number of DevStream"}]}],options:[{name:"--debug",description:"Debug level log",isPersistent:!0},{name:["--help","-h"],description:"Display help",isPersistent:!0}]},Ve=De;export{Ve as default};
